## üìå –¶–µ–ª—å:

–ù–∞—É—á–∏—Ç—å—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ú—ã –∏–∑–æ–ª–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Docker, –ø—Ä–∏ —ç—Ç–æ–º –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ, –∫–∞–∫ –∏ Nginx.
–≠—Ç–æ –±–∞–∑–æ–≤—ã–π –∏ –≤–∞–∂–Ω—ã–π —à–∞–≥ ‚Äî –Ω–∞—á–∞–ª–æ –ø—É—Ç–∏ –∫ –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏.

## –ß—Ç–æ –º—ã –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å

–í —ç—Ç–æ–º —à–∞–≥–µ:

    –ú—ã —Å–æ–∑–¥–∞–¥–∏–º Dockerfile ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

    –û–±–µ—Å–ø–µ—á–∏–º –∑–∞–ø—É—Å–∫ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

    –†–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ Flask —É–∑–Ω–∞—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã).

    –ù–∞—É—á–∏–º—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å .env –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ.

    PostgreSQL –∏ Nginx –ø–æ–∫–∞ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–º
```sh
flask-postgres-nginx-starter/
‚îú‚îÄ‚îÄ Dockerfile              ‚Üê –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ entrypoint.sh           ‚Üê —Å–∫—Ä–∏–ø—Ç –æ–∂–∏–¥–∞–Ω–∏—è –ë–î
‚îú‚îÄ‚îÄ .dockerignore           ‚Üê —á—Ç–æ–±—ã –Ω–µ –≤–∫–ª—é—á–∞—Ç—å –ª–∏—à–Ω–µ–µ
‚îî‚îÄ‚îÄ .env.example            ‚Üê –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—ã

```


## ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã —É–±–µ–¥–∏—Å—å, —á—Ç–æ:

    –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker

    Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø—Ä–æ–µ–∫—Ç flask-postgres-nginx-starter) —Ä–∞–±–æ—Ç–∞–µ—Ç —É —Ç–µ–±—è –ª–æ–∫–∞–ª—å–Ω–æ

    PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–∞ —Ö–æ—Å—Ç–µ), –∫–∞–∫ —Ç—ã —É–∂–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª —Ä–∞–Ω–µ–µ

## –°–æ–∑–¥–∞–π —Ñ–∞–π–ª Dockerfile –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
```Dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ Python
FROM python:3.11-slim

# –ù–∞–∑–Ω–∞—á–∏–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
WORKDIR /app

# –û—Ç–∫–ª—é—á–∏–º –∫—ç—à Python –∏ –≤–∫–ª—é—á–∏–º –≤—ã–≤–æ–¥
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# –ö–æ–ø–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
COPY . .

# –î–µ–ª–∞–µ–º —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–π
RUN chmod +x entrypoint.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç entrypoint –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
ENTRYPOINT ["/app/entrypoint.sh"]

```
## –°–æ–∑–¥–∞–π .dockerignore
```plaintext
venv/
__pycache__/
*.pyc
*.pyo
*.pyd
.env
```
_üîí –í–∞–∂–Ω–æ: .env –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äî —Ç–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ. –ù–æ –Ω–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º._
## –°–∫—Ä–∏–ø—Ç entrypoint.sh
```sh
#!/bin/bash

# –ñ–¥—ë–º, –ø–æ–∫–∞ PostgreSQL —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
if [ "$DATABASE" = "postgres" ]; then
  echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ PostgreSQL –Ω–∞ $SQL_HOST:$SQL_PORT..."

  while ! nc -z $SQL_HOST $SQL_PORT; do
    sleep 0.1
  done

  echo "‚úÖ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
fi

# –ü–µ—Ä–µ–¥–∞—ë–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Gunicorn –∏–ª–∏ Flask
exec "$@"
```
## –ü—Ä–∏–º–µ—Ä .env.example
```ini
FLASK_ENV=development
DATABASE=postgres
SQL_HOST=127.0.0.1
SQL_PORT=5432
SQL_USER=appuser
SQL_PASSWORD=secret
SQL_DATABASE=myapp
```
_‚úÖ –°–æ–∑–¥–∞–π —Å–≤–æ–π .env –ø–æ —ç—Ç–æ–º—É —à–∞–±–ª–æ–Ω—É:_
```sh
cp .env.example .env
```

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```sh
docker build -t flask-docker-app .
```
## –ó–∞–ø—É—Å–∫
```sh
docker run -it --rm --env-file .env -p 5000:5000 flask-docker-app python app.py
```
–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:

    –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä flask-docker-app;

    –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env;

    –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç 5000 —Ö–æ—Å—Ç–∞ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞;

    –≤—ã–ø–æ–ª–Ω—è–µ—Ç python app.py, —Ç–æ –µ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞–µ—Ç Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é;

    –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ (-it) –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ (--rm).

‚ö†Ô∏è –¢–∞–∫–æ–π —Å–ø–æ—Å–æ–± —É–¥–æ–±–µ–Ω –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –Ω–æ –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ:

    –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ –ø—Ä–∏ —Å–±–æ–µ;

    –Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è;

    –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ —Ñ–æ–Ω–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (background);

    –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, gunicorn).

## –ó–∞–ø—É—Å–∫ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
–ò—Å–ø–æ–ª—å–∑—É–µ–º Gunicorn –≤–º–µ—Å—Ç–æ python app.py

Gunicorn ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-ready WSGI-—Å–µ—Ä–≤–µ—Ä. –ú—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –µ–≥–æ –≤ requirements.txt.

–í Dockerfile –º—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞–ª–∏ —è–≤–Ω—ã–π –∑–∞–ø—É—Å–∫, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏:

```sh
ENTRYPOINT ["/app/entrypoint.sh"]
```
–ê –≤ entrypoint.sh –≤ –∫–æ–Ω—Ü–µ:
```sh
exec "$@"
```
_–≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É, –∏ –æ–Ω–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∞._
–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Gunicorn

–°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø—É—Å–∫ –±–µ–∑ -it –∏ --rm, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–ª –≤ —Ñ–æ–Ω–µ:
```sh
docker run -d \
  --name flask-app \
  --env-file .env \
  -p 5000:5000 \
  flask-docker-app \
  gunicorn -b 0.0.0.0:5000 app:app
```
–†–∞–∑–±–æ—Ä:

    -d ‚Äî detached (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ);

    --name flask-app ‚Äî –¥–∞—ë—Ç –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É;

    -p 5000:5000 ‚Äî –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞;

    gunicorn -b 0.0.0.0:5000 app:app ‚Äî –∑–∞–ø—É—Å–∫ Gunicorn, —Å–ª—É—à–∞—é—â–∏–π –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º app –∏–∑ —Ñ–∞–π–ª–∞ app.py.

–ü—Ä–æ–≤–µ—Ä–∫–∞

    –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω:

```sh
docker ps
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
–û—Ç–∫—Ä–æ–π—Ç–µ http://<IP-—Å–µ—Ä–≤–µ—Ä–∞>:5000
–ï—Å–ª–∏ –≤—ã –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ ‚Äî http://localhost:5000

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
```sh
docker logs flask-app
```
